<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>縦棒シフト人数</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .main-container { display: flex; align-items: flex-start; overflow-x: auto; gap: 20px; }
    .time-and-bar-column { display: flex; flex-direction: column; align-items: center; }
    .time-column { display: flex; flex-direction: column; align-items: flex-end; margin-right: 5px; }
    .time-label { height: 24px; font-size: 11px; color: #333; white-space: nowrap; line-height: 24px; }
    .day-bar { width: 60px; display: flex; flex-direction: column; border: 1px solid #ccc; background: #f8f8f8; }
    .segment { width: 100%; text-align: center; font-size: 12px; color: white; background: steelblue; border-top: 1px solid #000; position: relative; }
    .segment-label { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: bold; font-size: 12px; white-space: nowrap; }
    .date-label { margin-top: 5px; font-size: 13px; font-weight: bold; text-align: center; }
    .note-text { font-size: 11px; font-weight: normal; margin-top: 2px; color: #555; }
    .tooltip { display: none; position: absolute; background: #333; color: #fff; padding: 5px 10px; border-radius: 4px; font-size: 12px; white-space: nowrap; pointer-events: none; z-index: 100; }
  </style>
</head>
<body>
<h2>時間ごとのシフト人数（縦棒表示）</h2>

<div class="main-container">
  {% for date, segments in bar_data.items() %}
  <div class="time-and-bar-column">
    <div style="display:flex;">
      <div class="time-column">
        {% for seg in segments %}
          <div class="time-label" style="height: {{ seg.duration * 1.6 }}px;">{{ (seg.start[:2]|int + (seg.start[3:]|int) / 60)|round(1) }}</div>
        {% endfor %}
      </div>

      <div class="day-bar">
        {% for seg in segments %}
          <div class="segment" style="height: {{ seg.duration * 1.6 }}px;" data-members="{{ seg.members|join(', ') }}">
            {% if seg.duration > 0.5 %}
              <div class="segment-label">{{ seg.count }}人</div>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>

    <div class="date-label">
      {{ date[5:] }}
      {% if notes.get(date) %}
        <div class="note-text">{{ notes[date] }}</div>
      {% endif %}
    </div>

  </div>
  {% endfor %}
</div>

<div id="tooltip" class="tooltip"></div>

<script>
const tooltip = document.getElementById('tooltip');

const segments = document.querySelectorAll('.segment');
segments.forEach(seg => {
  seg.addEventListener('mouseover', (e) => {
    const members = seg.dataset.members;
    if (members && members.trim()) {
      tooltip.textContent = members;
      tooltip.style.display = 'block';
      const rect = seg.getBoundingClientRect();
      tooltip.style.top = `${rect.top + window.scrollY}px`;
      tooltip.style.left = `${rect.right + 10}px`;
    }
  });
  seg.addEventListener('mouseout', () => {
    tooltip.style.display = 'none';
  });
});
</script>

</body>
</html>
